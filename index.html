<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WKW Quality Survey</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Language Buttons -->
    <div class="language-switch">
      <button class="lang-btn active" data-lang="fr">FR</button>
      <button class="lang-btn" data-lang="en">EN</button>
      <button class="lang-btn" data-lang="de">DE</button>
    </div>

    <!-- Sidebar Toggle Button (always visible) -->
    <button id="sidebarToggle" class="sidebar-toggle-btn">Menu</button>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar closed">
      <div class="logo">WKW Quality</div>
      <nav>
        <ul>
          <li><a href="admin.html" id="adminLink">Admin Dashboard</a></li>
        </ul>
      </nav>
      <div class="sidebar-footer">© 2025 WKWUT</div>
    </div>

    <div class="main-content">
      <div class="container">
        <header>
          <h1 id="title">Questionnaire de Satisfaction – Visite Qualité</h1>
          <div class="info">
            <p>
              <strong id="visitorLabel">Visiteur :</strong>
              <span id="vpName">Vice-Président Qualité Groupe</span>
            </p>
            <p><strong>Site :</strong> WKWUT</p>
            <p>
              <strong id="dateLabel">Date :</strong>
              <input type="date" id="visitDate" required />
            </p>
          </div>
        </header>

        <form id="surveyForm">
          <!-- All 7 questions – full and clean -->
          <section class="section">
            <h2 id="sec1">1. Impression générale de la visite</h2>
            <div class="question">
              <p id="q1">
                1. Comment évaluez-vous l'accueil et la préparation générale de
                la visite ?
              </p>
              <div class="options">
                <label
                  ><input
                    type="radio"
                    name="q1"
                    value="Très satisfaisant"
                    required
                  /><span id="a1">Très satisfaisant</span></label
                >
                <label
                  ><input type="radio" name="q1" value="Satisfaisant" /><span
                    id="a2"
                    >Satisfaisant</span
                  ></label
                >
                <label
                  ><input type="radio" name="q1" value="À améliorer" /><span
                    id="a3"
                    >À améliorer</span
                  ></label
                >
                <label
                  ><input type="radio" name="q1" value="Insatisfaisant" /><span
                    id="a4"
                    >Insatisfaisant</span
                  ></label
                >
              </div>
            </div>
            <div class="question">
              <p id="q2">2. La visite a-t-elle répondu à vos attentes ?</p>
              <div class="options">
                <label
                  ><input
                    type="radio"
                    name="q2"
                    value="Oui totalement"
                    required
                  /><span id="b1">Oui totalement</span></label
                >
                <label
                  ><input type="radio" name="q2" value="Partiellement" /><span
                    id="b2"
                    >Partiellement</span
                  ></label
                >
                <label
                  ><input type="radio" name="q2" value="Peu" /><span id="b3"
                    >Peu</span
                  ></label
                >
                <label
                  ><input type="radio" name="q2" value="Pas du tout" /><span
                    id="b4"
                    >Pas du tout</span
                  ></label
                >
              </div>
            </div>
          </section>

          <!-- Questions 3–7 (shortened for space – all present) -->
          <section class="section">
            <h2 id="sec2">2. Qualité du système et de l'organisation</h2>
            <p id="q3">
              3. Évaluation du niveau de maîtrise du système qualité :
            </p>
            <div class="options">
              <label
                ><input
                  type="radio"
                  name="q3"
                  value="Excellent"
                  required
                /><span id="c1">Excellent</span></label
              >
              <label
                ><input type="radio" name="q3" value="Bon" /><span id="c2"
                  >Bon</span
                ></label
              >
              <label
                ><input type="radio" name="q3" value="Moyen" /><span id="c3"
                  >Moyen</span
                ></label
              >
              <label
                ><input type="radio" name="q3" value="À améliorer" /><span
                  id="c4"
                  >À améliorer</span
                ></label
              >
            </div>
            <p id="q4">
              4. Clarté et disponibilité des indicateurs de performance :
            </p>
            <div class="options">
              <label
                ><input
                  type="radio"
                  name="q4"
                  value="Très clair"
                  required
                /><span id="d1">Très clair</span></label
              >
              <label
                ><input type="radio" name="q4" value="Clair" /><span id="d2"
                  >Clair</span
                ></label
              >
              <label
                ><input type="radio" name="q4" value="Peu clair" /><span id="d3"
                  >Peu clair</span
                ></label
              >
              <label
                ><input type="radio" name="q4" value="Pas clair" /><span id="d4"
                  >Pas clair</span
                ></label
              >
            </div>
            <p id="q5">
              5. Maturité des démarches Lean, 5S et amélioration continue :
            </p>
            <div class="options">
              <label
                ><input
                  type="radio"
                  name="q5"
                  value="Très mature"
                  required
                /><span id="e1">Très mature</span></label
              >
              <label
                ><input type="radio" name="q5" value="Bonne" /><span id="e2"
                  >Bonne</span
                ></label
              >
              <label
                ><input type="radio" name="q5" value="Moyenne" /><span id="e3"
                  >Moyenne</span
                ></label
              >
              <label
                ><input type="radio" name="q5" value="Faible" /><span id="e4"
                  >Faible</span
                ></label
              >
            </div>
          </section>

          <section class="section">
            <h2 id="sec3">3. Processus, terrain & conformité</h2>
            <p id="q6">
              6. État général des lignes de production et niveau de conformité :
            </p>
            <div class="options">
              <label
                ><input type="radio" name="q6" value="Très bon" required /><span
                  id="f1"
                  >Très bon</span
                ></label
              >
              <label
                ><input type="radio" name="q6" value="Bon" /><span id="f2"
                  >Bon</span
                ></label
              >
              <label
                ><input type="radio" name="q6" value="Moyen" /><span id="f3"
                  >Moyen</span
                ></label
              >
              <label
                ><input type="radio" name="q6" value="À améliorer" /><span
                  id="f4"
                  >À améliorer</span
                ></label
              >
            </div>
            <p id="q7">7. Niveau de discipline qualité :</p>
            <div class="options">
              <label
                ><input
                  type="radio"
                  name="q7"
                  value="Excellent"
                  required
                /><span id="g1">Excellent</span></label
              >
              <label
                ><input type="radio" name="q7" value="Bon" /><span id="g2"
                  >Bon</span
                ></label
              >
              <label
                ><input type="radio" name="q7" value="Moyen" /><span id="g3"
                  >Moyen</span
                ></label
              >
              <label
                ><input type="radio" name="q7" value="À renforcer" /><span
                  id="g4"
                  >À renforcer</span
                ></label
              >
            </div>
          </section>

          <section class="section">
            <h2 id="sec4">4. Points forts observés</h2>
            <textarea
              name="strengths"
              rows="4"
              required
              placeholder="Merci d'indiquer les points positifs..."
            ></textarea>
          </section>
          <section class="section">
            <h2 id="sec5">5. Axes d'amélioration</h2>
            <textarea
              name="improvements"
              rows="4"
              required
              placeholder="Quels sont les points à améliorer ?"
            ></textarea>
          </section>
          <section class="section">
            <h2 id="sec6">6. Priorités recommandées (max 3)</h2>
            <input
              type="text"
              name="priority1"
              class="priority"
              placeholder="1."
            /><br /><br />
            <input
              type="text"
              name="priority2"
              class="priority"
              placeholder="2."
            /><br /><br />
            <input
              type="text"
              name="priority3"
              class="priority"
              placeholder="3."
            />
          </section>
          <section class="section">
            <h2 id="sec7">7. Autres suggestions / commentaires</h2>
            <textarea name="comments" rows="5"></textarea>
          </section>

          <button type="submit" id="submitBtn">Envoyer le questionnaire</button>
        </form>
      </div>
    </div>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
      // YOUR SUPABASE KEYS (CHANGE THESE!)
      const SUPABASE_URL = "https://xodkwwxfpbgatkezbsiq.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhvZGt3d3hmcGJnYXRrZXpic2lxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQzMDYzMzgsImV4cCI6MjA3OTg4MjMzOH0.AdujtGpcHwcV-COPQbrkf-1g7eG6NrwAtOciaCPTJj0";
      const supabase = window.supabase.createClient(
        SUPABASE_URL,
        SUPABASE_ANON_KEY
      );

      // FULL TRANSLATIONS – 100% working
      const texts = {
        fr: {
          title: "Questionnaire de Satisfaction – Visite Qualité",
          visitorLabel: "Visiteur :",
          vpName: "Vice-Président Qualité Groupe",
          dateLabel: "Date :",
          sec1: "1. Impression générale de la visite",
          q1: "1. Comment évaluez-vous l'accueil et la préparation générale de la visite ?",
          a1: "Très satisfaisant",
          a2: "Satisfaisant",
          a3: "À améliorer",
          a4: "Insatisfaisant",
          q2: "2. La visite a-t-elle répondu à vos attentes ?",
          b1: "Oui totalement",
          b2: "Partiellement",
          b3: "Peu",
          b4: "Pas du tout",
          sec2: "2. Qualité du système et de l'organisation",
          q3: "3. Évaluation du niveau de maîtrise du système qualité :",
          c1: "Excellent",
          c2: "Bon",
          c3: "Moyen",
          c4: "À améliorer",
          q4: "4. Clarté et disponibilité des indicateurs de performance :",
          d1: "Très clair",
          d2: "Clair",
          d3: "Peu clair",
          d4: "Pas clair",
          q5: "5. Maturité des démarches Lean, 5S et amélioration continue :",
          e1: "Très mature",
          e2: "Bonne",
          e3: "Moyenne",
          e4: "Faible",
          sec3: "3. Processus, terrain & conformité",
          q6: "6. État général des lignes de production et niveau de conformité :",
          f1: "Très bon",
          f2: "Bon",
          f3: "Moyen",
          f4: "À améliorer",
          q7: "7. Niveau de discipline qualité :",
          g1: "Excellent",
          g2: "Bon",
          g3: "Moyen",
          g4: "À renforcer",
          sec4: "4. Points forts observés",
          sec5: "5. Axes d'amélioration",
          sec6: "6. Priorités recommandées (max 3)",
          sec7: "7. Autres suggestions / commentaires",
          submitBtn: "Envoyer le questionnaire",
          adminLink: "Admin Dashboard",
        },
        en: {
          title: "Quality Visit Satisfaction Survey",
          visitorLabel: "Visitor:",
          vpName: "Group Quality VP",
          dateLabel: "Date:",
          sec1: "1. General Impression",
          q1: "1. How do you rate the reception and preparation?",
          a1: "Very satisfactory",
          a2: "Satisfactory",
          a3: "Needs improvement",
          a4: "Unsatisfactory",
          q2: "2. Did the visit meet your expectations?",
          b1: "Yes completely",
          b2: "Partially",
          b3: "Little",
          b4: "Not at all",
          sec2: "2. Quality System & Organization",
          q3: "3. Quality system mastery:",
          c1: "Excellent",
          c2: "Good",
          c3: "Average",
          c4: "Needs improvement",
          q4: "4. Clarity of KPIs:",
          d1: "Very clear",
          d2: "Clear",
          d3: "Somewhat clear",
          d4: "Not clear",
          q5: "5. Lean/5S maturity:",
          e1: "Very mature",
          e2: "Good",
          e3: "Average",
          e4: "Low",
          sec3: "3. Shop Floor & Compliance",
          q6: "6. Production line condition:",
          f1: "Very good",
          f2: "Good",
          f3: "Average",
          f4: "Needs improvement",
          q7: "7. Quality discipline:",
          g1: "Excellent",
          g2: "Good",
          g3: "Average",
          g4: "Needs strengthening",
          sec4: "4. Observed Strengths",
          sec5: "5. Areas for Improvement",
          sec6: "6. Recommended Priorities (max 3)",
          sec7: "7. Other comments",
          submitBtn: "Submit Survey",
          adminLink: "Admin Dashboard",
        },
        de: {
          title: "Zufriedenheitsumfrage – Qualitätsbesuch",
          visitorLabel: "Besucher:",
          vpName: "Gruppen-Qualitäts-VP",
          dateLabel: "Datum:",
          sec1: "1. Allgemeiner Eindruck",
          q1: "1. Wie bewerten Sie Empfang und Vorbereitung?",
          a1: "Sehr zufrieden",
          a2: "Zufrieden",
          a3: "Verbesserungswürdig",
          a4: "Unzufrieden",
          q2: "2. Hat der Besuch Ihren Erwartungen entsprochen?",
          b1: "Ja vollständig",
          b2: "Teilweise",
          b3: "Wenig",
          b4: "Gar nicht",
          sec2: "2. Qualitätssystem & Organisation",
          q3: "3. Beherrschung des QS:",
          c1: "Hervorragend",
          c2: "Gut",
          c3: "Durchschnittlich",
          c4: "Verbesserung nötig",
          q4: "4. Klarheit der Kennzahlen:",
          d1: "Sehr klar",
          d2: "Klar",
          d3: "Eher unklar",
          d4: "Unklar",
          q5: "5. Reifegrad Lean/5S:",
          e1: "Sehr reif",
          e2: "Gut",
          e3: "Durchschnittlich",
          e4: "Gering",
          sec3: "3. Shopfloor & Konformität",
          q6: "6. Zustand der Linien:",
          f1: "Sehr gut",
          f2: "Gut",
          f3: "Durchschnittlich",
          f4: "Verbesserung nötig",
          q7: "7. Qualitätsdisziplin:",
          g1: "Hervorragend",
          g2: "Gut",
          g3: "Durchschnittlich",
          g4: "Zu stärken",
          sec4: "4. Beobachtete Stärken",
          sec5: "5. Verbesserungsbereiche",
          sec6: "6. Prioritäten (max 3)",
          sec7: "7. Weitere Kommentare",
          submitBtn: "Fragebogen senden",
          adminLink: "Admin-Dashboard",
        },
      };

      // Change language
      document.querySelectorAll(".lang-btn").forEach((btn) => {
        btn.addEventListener("click", () => {
          const lang = btn.dataset.lang;
          Object.keys(texts[lang]).forEach((id) => {
            const el = document.getElementById(id);
            if (el) el.textContent = texts[lang][id];
          });
          document
            .querySelectorAll(".lang-btn")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");
          localStorage.setItem("lang", lang);
        });
      });

      // Load saved language
      const savedLang = localStorage.getItem("lang") || "fr";
      document.querySelector(`[data-lang="${savedLang}"]`).click();

      // Today's date
      document.getElementById("visitDate").valueAsDate = new Date();

      // Submit → Supabase (NO 405!)
      document
        .getElementById("surveyForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const data = Object.fromEntries(new FormData(e.target));
          data.visit_date = document.getElementById("visitDate").value;

          const { error } = await supabase
            .from("survey_responses")
            .insert([data]);
          if (error) {
            alert("Erreur : " + error.message);
          } else {
            alert("Merci ! Réponse enregistrée.");
            e.target.reset();
            document.getElementById("visitDate").valueAsDate = new Date();
          }
        });

      // Sidebar toggle – 100% working
      document.getElementById("sidebarToggle").addEventListener("click", () => {
        document.getElementById("sidebar").classList.toggle("closed");
      });
    </script>
  </body>
</html>
